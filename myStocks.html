<!doctype html>

<!--  -->

<html class="no-js" lang="">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="x-ua-compatible" content="ie=edge">
    <title>Dynamic Stock Ticker</title>
    <meta name="description" content="">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <link rel="manifest" href="site.webmanifest">
    <link rel="apple-touch-icon" href="icon.png">
    <!-- Place favicon.ico in the root directory -->

    <link rel="stylesheet" href="css/normalize.css">
    <link rel="stylesheet" href="css/main.css">
  </head>
  <body>
    <!--[if lte IE 9]>
        <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
        <![endif]-->

    <!-- Add your site or application content here -->

    <a id='header'>
      <h1 id='title'>DB Ticker</h1>
    </a>
	
	<div class="buttonHeader">
	  <input type="button" onclick="location.href='index.html';" value="Exchange Info"/>
	  <input type="button" onclick="location.href='myStocks.html';" value="My Stocks"/>
	  <input type="button" onclick="location.href='ftcMode.html';" value="FTC Mode"/>
	</div>
	
    <a class='section'>  
      <a id='query'>
		<div id="myStockPriceTrend">
		</div>
	  </a>
      <a id='result'>
		<div id="myStockListing">
		  
		</div>
	  </a>
	</a>
        <!-- Styles -->
<style>
#chartdiv {
	width		: 100%;
	height		: 500px;
	font-size	: 11px;
}																	
</style>

<!-- Resources -->
<script src="https://www.amcharts.com/lib/3/amcharts.js"></script>
<script src="https://www.amcharts.com/lib/3/serial.js"></script>
<script src="https://www.amcharts.com/lib/3/plugins/export/export.min.js"></script>
<link rel="stylesheet" href="https://www.amcharts.com/lib/3/plugins/export/export.css" type="text/css" media="all" />
<script src="https://www.amcharts.com/lib/3/themes/light.js"></script>

<!-- Chart code -->
<?php
	 $db = pg_connect("host=localhost port=5432 dbname=final user=postgres password=yolo");
	 $query = "select sd.day, sd.high from stock_day sd, stock s where s.ticker_name = 'AAPL' AND sd.ticker_name = s.ticker_name AND sd.type = s.type";
	 $result = pg_query($query);
	 $days = array();
	 $prices = array();
	 while ($row = pg_fetch_assoc($result)){
	 $days = array_merge($days, array_map('trim', explode(",", $row['day'])));
	 $prices = array_merge($prices, array_map('trim', explode(",", $row['high'])));
}
	 json_encode($days);
	 json_encode($prices);
?>
<script type = text/javascript>
var chartData = generatechartData();

function generatechartData() {

    var chartData = [];
    var days = <?php echo json_encode($days) ?>; 
    var prices = <?php echo json_encode($prices) ?>;

    for (var i = days.length-1; i >= 0; i--) {
	
        chartData.push({
            date: String(new Date(days[i])), 
	    prices: prices[i]}
	);
    }

    return chartData;
}


var chart = AmCharts.makeChart("chartdiv", {
    "theme": "light",
    "type": "serial",
    "marginRight": 80,
    "autoMarginOffset": 20,
    "marginTop":20,
    "dataProvider": chartData,
    "valueAxes": [{
        "id": "v1",
        "axisAlpha": 0.1
    }],
    "graphs": [{
        "useNegativeColorIfDown": true,
        "balloonText": "[[category]]<br><b>value: [[value]]</b>",
        "bullet": "round",
        "bulletBorderAlpha": 1,
        "bulletBorderColor": "#FFFFFF",
        "hideBulletsCount": 50,
        "lineThickness": 2,
        "lineColor": "#fdd400",
        "negativeLineColor": "#67b7dc",
        "valueField": "prices"
    }],
    "chartScrollbar": {
        "scrollbarHeight": 5,
        "backgroundAlpha": 0.1,
        "backgroundColor": "#868686",
        "selectedBackgroundColor": "#67b7dc",
        "selectedBackgroundAlpha": 1
    },
    "chartCursor": {
        "valueLineEnabled": true,
        "valueLineBalloonEnabled": true
    },
    "categoryField": "date",
    "categoryAxis": {
        "parseDates": true,
        "axisAlpha": 0,
        "minHorizontalGap": 60
    },
    "export": {
        "enabled": true
    }
});

chart.addListener("dataUpdated", zoomChart);
//zoomChart();

function zoomChart() {
    if (chart.zoomToIndexes) {
        chart.zoomToIndexes(130, chartData.length - 1);
    }
}
</script>

<!-- HTML -->
<div id="chartdiv"></div>			
        <script src="js/vendor/modernizr-3.5.0.min.js"></script>
        <script src="https://code.jquery.com/jquery-3.2.1.min.js" integrity="sha256-hwg4gsxgFZhOsEEamdOYGBf13FyQuiTwlAQgxVSNgt4=" crossorigin="anonymous"></script>
        <script>window.jQuery || document.write('<script src="js/vendor/jquery-3.2.1.min.js"><\/script>')</script>
          <script src="js/plugins.js"></script>
          <script src="js/main.js"></script>

          <!-- Google Analytics: change UA-XXXXX-Y to be your site's ID. -->
          <script>
            window.ga=function(){ga.q.push(arguments)};ga.q=[];ga.l=+new Date;
            ga('create','UA-XXXXX-Y','auto');ga('send','pageview')
          </script>
          <script src="https://www.google-analytics.com/analytics.js" async defer></script>
	
  </body>
   <?php
	 $db = pg_connect("host=localhost port=5432 dbname=final user=postgres password=yolo");
	 $query = "SELECT * FROM company";
	 $result = pg_query($query);
	 $row = pg_fetch_assoc($result);
	 echo "<p value='$row[ticker_name]'></p>";
?>
</html>
